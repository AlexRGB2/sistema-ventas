import{a as $e}from"./chunk-JIPGNADR.js";import{a as Y}from"./chunk-NKP6BXZB.js";import{A as ve,B as xe,F as we,G as Se,H as Ee,I as ke,J as De,K as ye,L as Me,M as Ie,N as Ue,O as Te,P as Fe,Q as Re,R as $,S as N,T as j,U as Ae,V as Pe,W as B,X as L,Y as O,Z as Ve,a as le,b as D,e as y,f as me,k as ce,l as d,m as de,n as pe,o as ue,p as fe,q as he,r as ge,s as be,x as _e,y as Ce}from"./chunk-C43BA76M.js";import{a as se,m as Q}from"./chunk-MFKGNWZG.js";import"./chunk-IX6G3U3V.js";import{$b as oe,Bb as Z,Cb as ee,Db as o,E as w,Eb as a,Fb as f,Gb as E,Hb as k,Jb as V,Mb as g,Mc as ae,Ob as v,Pc as ne,Sb as te,Tb as ie,Ub as re,W as b,Wb as n,Xb as _,Yb as C,Za as l,_a as c,aa as K,ba as A,c as H,fa as W,j as R,ka as S,la as P,q as J,rb as h,ta as I,tb as u,ua as U,zb as X}from"./chunk-M7QQO3YR.js";var q=(()=>{let t=class t{constructor(r,i){this.http=r,this.snackBar=i,this.API_URL=`${Y.API_URL}/user`}getUsers(){return this.http.get(`${this.API_URL}/getUsers`,{headers:{requireToken:"true"}}).pipe(w(r=>this.handlerError(r)))}getRoles(){return this.http.get(`${Y.API_URL}/rol/getRolesUso`,{headers:{requireToken:"true"}}).pipe(w(r=>this.handlerError(r)))}newUser(r){return this.http.post(`${this.API_URL}/newUser`,r,{headers:{requireToken:"true"}}).pipe(w(i=>this.handlerError(i)))}updateUser(r){return this.http.put(`${this.API_URL}/updateUser`,r,{headers:{requireToken:"true"}}).pipe(w(i=>this.handlerError(i)))}deleteUser(r){return this.http.delete(`${this.API_URL}/deleteUser/${r}`,{headers:{requireToken:"true"}}).pipe(w(i=>this.handlerError(i)))}handlerError(r){var i="Ocurri\xF3 un error";return r.error&&(r.error.message?i=r.error.message:i="Ocurri\xF3 un error"),this.snackBar.open(i,"",{duration:3e3}),J(()=>{new Error(i)})}};t.\u0275fac=function(i){return new(i||t)(W(se),W(y))},t.\u0275prov=K({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function He(e,t){if(e&1&&(o(0,"mat-option",7),n(1),a()),e&2){let m=t.$implicit;u("value",m.cverol),l(),C(" ",m.descripcion+" - "+m.clave," ")}}function We(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),n(2,"Contrase\xF1a"),a(),f(3,"input",14),o(4,"mat-error"),n(5),a()()),e&2){let m=v();l(5),C(" ",m.baseForm.getErrorMessage(m.userForm.get("password"))," ")}}function Qe(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),n(2,"Confirmar Contrase\xF1a"),a(),f(3,"input",15),o(4,"mat-error"),n(5),a()()),e&2){let m=v();l(5),C(" ",m.baseForm.getErrorMessage(m.userForm.get("confirmPassword"))," ")}}function Ye(e,t){if(e&1){let m=V();o(0,"button",16),g("click",function(){I(m);let i=v();return U(i.userForm.reset())}),n(1," Limpiar "),a()}}var M=function(e){return e.EDIT="edit",e.NEW="new",e}(M||{}),Oe=(()=>{let t=class t{constructor(r,i,s,p,z,F){this.data=r,this.fb=i,this.baseForm=s,this.userService=p,this.snackBar=z,this.dialogRef=F,this.destroy$=new R,this.titleButton="Guardar",this.actionTodo=M.NEW,this.roles=[],this.userForm=this.fb.group({cveusuario:[""],nombre:["",[d.required,d.minLength(3)]],apellidos:["",[d.required,d.minLength(3)]],username:["",[d.required,d.email]],rol:["",[d.required]],password:["",[d.required,d.minLength(8)]],confirmPassword:["",[d.required]]})}ngOnInit(){this.userService.getRoles().pipe(b(this.destroy$)).subscribe(r=>{this.roles=r,this.pathData(),this.togglePasswordVisibility()})}pathData(){this.data.user.cveusuario?(this.titleButton="Actualizar",this.actionTodo=M.EDIT,this.userForm.patchValue({cveusuario:this.data.user.cveusuario,nombre:this.data.user.nombre,apellidos:this.data.user.apellidos,username:this.data.user.username,rol:this.data.user.rol.cverol}),this.userForm.get("username")?.disable(),this.userForm.updateValueAndValidity()):(this.titleButton="Guardar",this.actionTodo=M.NEW)}onSave(){if(this.userForm.invalid)return;let r=this.userForm.getRawValue();if(this.actionTodo===M.NEW){let i=r,{confirmPassword:p,cveusuario:z}=i,F=H(i,["confirmPassword","cveusuario"]);this.userService.newUser(F).pipe(b(this.destroy$)).subscribe(x=>{this.snackBar.open(x.message,"Aceptar",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:"snackbar-success"}),this.dialogRef.close(x)},x=>{this.snackBar.open("Ocurri\xF3 un error al guardar el usuario","Aceptar",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:"snackbar-error"})})}else{let s=r,{confirmPassword:p,password:z,username:F}=s,x=H(s,["confirmPassword","password","username"]);console.log(x),this.userService.updateUser(x).pipe(b(this.destroy$)).subscribe(G=>{this.snackBar.open(G.message,"Aceptar",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:"snackbar-success"}),this.dialogRef.close(G)},G=>{this.snackBar.open("Ocurri\xF3 un error al actualizar el usuario","Aceptar",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:"snackbar-error"})})}}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}togglePasswordVisibility(){let r=this.userForm.get("password"),i=this.userForm.get("confirmPassword");this.actionTodo===M.NEW?(r?.setValidators([d.required,d.minLength(8)]),i?.setValidators([d.required])):(r?.clearValidators(),i?.clearValidators()),r?.updateValueAndValidity(),i?.updateValueAndValidity()}};t.\u0275fac=function(i){return new(i||t)(c(j),c(ge),c($e),c(q),c(y),c(N))},t.\u0275cmp=S({type:t,selectors:[["app-usuario-dialog"]],decls:39,vars:9,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","email","formControlName","username","matInput",""],["formControlName","rol"],[3,"value"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["mat-flat-button","","type","button","color","warn","class","me-2",3,"click",4,"ngIf"],["mat-flat-button","","type","submit"],["align","end"],["mat-button","","mat-dialog-close",""],["type","password","formControlName","password","matInput","","autocomplete","new-password"],["type","password","formControlName","confirmPassword","matInput",""],["mat-flat-button","","type","button","color","warn",1,"me-2",3,"click"]],template:function(i,s){i&1&&(o(0,"h1",0),n(1,"Usuario"),a(),o(2,"mat-dialog-content")(3,"form",1),g("submit",function(){return s.onSave()}),o(4,"mat-form-field",2)(5,"mat-label"),n(6,"Nombre"),a(),f(7,"input",3),o(8,"mat-error"),n(9),a()(),o(10,"mat-form-field",2)(11,"mat-label"),n(12,"Apellidos"),a(),f(13,"input",4),o(14,"mat-error"),n(15),a()(),o(16,"mat-form-field",2)(17,"mat-label"),n(18,"Nombre de Usuario"),a(),f(19,"input",5),o(20,"mat-error"),n(21),a()(),o(22,"mat-form-field",2)(23,"mat-label"),n(24,"Rol"),a(),o(25,"mat-select",6),Z(26,He,2,2,"mat-option",7,X),a(),o(28,"mat-error"),n(29),a()(),h(30,We,6,1,"mat-form-field",8)(31,Qe,6,1,"mat-form-field",8),o(32,"div",9),h(33,Ye,2,0,"button",10),o(34,"button",11),n(35),a()()()(),o(36,"mat-dialog-actions",12)(37,"button",13),n(38,"Cerrar"),a()()),i&2&&(l(3),u("formGroup",s.userForm),l(6),C(" ",s.baseForm.getErrorMessage(s.userForm.get("nombre"))," "),l(6),C(" ",s.baseForm.getErrorMessage(s.userForm.get("apellidos"))," "),l(6),C(" ",s.baseForm.getErrorMessage(s.userForm.get("username"))," "),l(5),ee(s.roles),l(3),C(" ",s.baseForm.getErrorMessage(s.userForm.get("rol"))," "),l(),u("ngIf",s.actionTodo==="new"),l(),u("ngIf",s.actionTodo==="new"),l(2),u("ngIf",s.actionTodo==="new"),l(2),_(s.titleButton))},dependencies:[ae,D,xe,ve,_e,Ce,Pe,B,O,L,Re,le,ue,ce,de,pe,fe,he],styles:[".snackbar-success .mdc-snackbar__surface{background-color:#4caf50!important}  .snackbar-success .mat-mdc-snack-bar-label{color:#fff!important;font-size:16px!important}  .snackbar-success .mat-mdc-snack-bar-action{color:#fff!important}  .snackbar-error .mdc-snackbar__surface{background-color:#af4c4c!important}  .snackbar-error .mat-mdc-snack-bar-label{color:#fff!important;font-size:16px!important}  .snackbar-error .mat-mdc-snack-bar-action{color:#fff!important}"]});let e=t;return e})();var qe=(()=>{let t=class t{constructor(r,i){this.dialogRef=r,this.data=i}onNoClick(){this.dialogRef.close(!1)}onYesClick(){this.dialogRef.close(!0)}};t.\u0275fac=function(i){return new(i||t)(c(N),c(j))},t.\u0275cmp=S({type:t,selectors:[["app-delete-dialog"]],decls:10,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click"]],template:function(i,s){i&1&&(o(0,"h1",0),n(1,"Confirmar"),a(),o(2,"div",1)(3,"p"),n(4),a()(),o(5,"div",2)(6,"button",3),g("click",function(){return s.onNoClick()}),n(7,"Cancelar"),a(),o(8,"button",4),g("click",function(){return s.onYesClick()}),n(9,"Eliminar"),a()()),i&2&&(l(4),_(s.data.message))},dependencies:[D,B,O,L]});let e=t;return e})();var Je=()=>[5,10,20,30,100];function Ke(e,t){e&1&&(o(0,"th",16),n(1,"Nombre"),a())}function Xe(e,t){if(e&1&&(o(0,"td",17),n(1),a()),e&2){let m=t.$implicit;l(),_(m.nombre)}}function Ze(e,t){e&1&&(o(0,"th",16),n(1,"Apellidos"),a())}function et(e,t){if(e&1&&(o(0,"td",17),n(1),a()),e&2){let m=t.$implicit;l(),_(m.apellidos)}}function tt(e,t){e&1&&(o(0,"th",16),n(1,"Username"),a())}function it(e,t){if(e&1&&(o(0,"td",17),n(1),a()),e&2){let m=t.$implicit;l(),_(m.username)}}function rt(e,t){e&1&&(o(0,"th",16),n(1,"Rol(es)"),a())}function ot(e,t){if(e&1&&(o(0,"td",17),n(1),a()),e&2){let m=t.$implicit;l(),_(m.rol.descripcion)}}function at(e,t){e&1&&f(0,"th",16)}function nt(e,t){if(e&1){let m=V();o(0,"td",18)(1,"button",19),g("click",function(){let i=I(m).$implicit,s=v();return U(s.onOpenModal(i))}),o(2,"mat-icon"),n(3,"edit"),a(),n(4," Editar "),a(),o(5,"button",20),g("click",function(){let i=I(m).$implicit,s=v();return U(s.confirmDelete(i.cveusuario,i.username))}),o(6,"mat-icon"),n(7,"delete"),a(),n(8," Eliminar "),a()()}}function st(e,t){e&1&&f(0,"tr",21)}function lt(e,t){e&1&&f(0,"tr",22)}var ze=(()=>{let t=class t{constructor(r,i,s){this.dialog=r,this.userService=i,this.snackBar=s,this.destroy$=new R,this.dataSource=new Fe,this.displayedColumns=["nombre","apellidos","username","rol","acciones"]}ngOnInit(){this.getUsers()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(r={}){this.dialog.open(Oe,{maxWidth:"100%",width:"80%",data:{user:r}}).afterClosed().pipe(b(this.destroy$)).subscribe(()=>{this.getUsers()})}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}getUsers(){this.userService.getUsers().pipe(b(this.destroy$)).subscribe(r=>{this.dataSource.data=r})}confirmDelete(r,i){this.dialog.open(qe,{width:"300px",data:{message:`\xBFEst\xE1 seguro de que desea eliminar el usuario ${i}?`}}).afterClosed().pipe(b(this.destroy$)).subscribe(p=>{p&&this.deleteUser(r)})}deleteUser(r){this.userService.deleteUser(r).pipe(b(this.destroy$)).subscribe(i=>{this.snackBar.open(i.message,"Aceptar",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:"snackbar-success"}),this.getUsers()})}};t.\u0275fac=function(i){return new(i||t)(c(Ae),c(q),c(y))},t.\u0275cmp=S({type:t,selectors:[["app-usuarios"]],viewQuery:function(i,s){if(i&1&&te($,5),i&2){let p;ie(p=re())&&(s.paginator=p.first)}},decls:27,vars:5,consts:[[1,"m-3"],["align","right"],["mat-flat-button","","color","primary",1,"m-2",3,"click"],[1,"table-content","mat-elevation-z8","m-4"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellidos"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,s){i&1&&(o(0,"h3",0),n(1,"Usuarios"),a(),o(2,"div",1)(3,"button",2),g("click",function(){return s.onOpenModal()}),o(4,"mat-icon"),n(5,"add"),a(),n(6," Agregar "),a()(),o(7,"div",3)(8,"table",4),E(9,5),h(10,Ke,2,0,"th",6)(11,Xe,2,1,"td",7),k(),E(12,8),h(13,Ze,2,0,"th",6)(14,et,2,1,"td",7),k(),E(15,9),h(16,tt,2,0,"th",6)(17,it,2,1,"td",7),k(),E(18,10),h(19,rt,2,0,"th",6)(20,ot,2,1,"td",7),k(),E(21,11),h(22,at,1,0,"th",6)(23,nt,9,0,"td",12),k(),h(24,st,1,0,"tr",13)(25,lt,1,0,"tr",14),a(),f(26,"mat-paginator",15),a()),i&2&&(l(8),u("dataSource",s.dataSource),l(16),u("matHeaderRowDef",s.displayedColumns),l(),u("matRowDefColumns",s.displayedColumns),l(),u("pageSizeOptions",oe(4,Je)))},dependencies:[D,me,we,Ee,Me,ke,Se,Ie,De,ye,Ue,Te,$],styles:[".snackbar-success .mdc-snackbar__surface{background-color:#4caf50!important}  .snackbar-success .mat-mdc-snack-bar-label{color:#fff!important;font-size:16px!important}  .snackbar-success .mat-mdc-snack-bar-action{color:#fff!important}"]});let e=t;return e})();var mt=[{path:"",component:ze}],Ge=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=P({type:t}),t.\u0275inj=A({imports:[Q.forChild(mt),Q]});let e=t;return e})();var Yt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=P({type:t}),t.\u0275inj=A({imports:[ne,Ge,Ve,be]});let e=t;return e})();export{Yt as UsuariosModule};
